{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "cad_obr/onus_obrigacoes.schema.json",
  "title": "CAD_OBR Onus/Obrigacoes Consolidado (v1)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "onus_id",
    "property_id",
    "registro_ref",
    "tipo_divida",
    "status",
    "janela_vigencia_inicio",
    "janela_vigencia_fim",
    "docs_origem"
  ],
  "properties": {
    "onus_id": { "$ref": "common.schema.json#/$defs/OnusId" },
    "property_id": { "$ref": "common.schema.json#/$defs/PropertyId" },
    "registro_ref": { "$ref": "common.schema.json#/$defs/RegistroRef" },

    "tipo_divida": {
      "type": "string",
      "minLength": 1
    },
    "operation_id": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/OperationId" },
        { "type": "null" }
      ]
    },

    "credor_id": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/PartyId" },
        { "type": "null" }
      ]
    },
    "emitente_devedor_id": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/PartyId" },
        { "type": "null" }
      ]
    },

    "data_efetiva": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/DateISO" },
        { "type": "null" }
      ]
    },
    "data_registro": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/DateISO" },
        { "type": "null" }
      ]
    },
    "vencimento": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/DateISO" },
        { "type": "null" }
      ]
    },
    "data_baixa": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/DateISO" },
        { "type": "null" }
      ]
    },

    "status": { "$ref": "common.schema.json#/$defs/OnusStatus" },

    "janela_vigencia_inicio": { "$ref": "common.schema.json#/$defs/DateISO" },
    "janela_vigencia_fim": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/DateISO" },
        { "type": "null" }
      ]
    },

    "valor_divida_original": {
      "anyOf": [{ "type": "string" }, { "type": "null" }]
    },
    "valor_divida": {
      "anyOf": [{ "type": "string" }, { "type": "null" }],
      "description": "String BR sem símbolo (ex.: \"67.250,51\")."
    },
    "valor_divida_num": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/MoneyCentavos" },
        { "type": "null" }
      ]
    },

    "valor_presente": {
      "anyOf": [{ "type": "string" }, { "type": "null" }],
      "description": "String BR sem símbolo (ou null quando não aplicável)."
    },
    "valor_presente_num": {
      "anyOf": [
        { "$ref": "common.schema.json#/$defs/MoneyCentavos" },
        { "type": "null" }
      ]
    },

    "monetary_meta": {
      "anyOf": [
        { "type": "object" },
        { "type": "null" }
      ],
      "description": "Meta de cálculo consolidada (espelho do _monetary_meta)."
    },

    "docs_origem": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "minLength": 8 }
    },
    "anchors": {
      "$ref": "common.schema.json#/$defs/AnchorsArray"
    }
  },

  "allOf": [
    {
      "if": {
        "properties": { "status": { "const": "BAIXADA" } },
        "required": ["status"]
      },
      "then": {
        "required": ["data_baixa"],
        "description": "Se status=BAIXADA, data_baixa deve estar preenchida."
      }
    }
  ]
}
