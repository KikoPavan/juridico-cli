{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://juridico-cli.local/schemas/peticao_processo.schema.json",
  "title": "peticao_processo — v2 (1:1)",
  "description": "Extração 1:1 de petição (inicial ou intermediária). Conteúdo literal, com âncoras por item relevante (pedidos, fatos, fundamentos etc.).",
  "type": "object",
  "required": ["document_type"],
  "properties": {
    "document_type": { "const": "peticao_processo" },

    "process_number": { "$ref": "#/$defs/AnchoredString" },

    "parties": {
      "type": "array",
      "items": { "$ref": "#/$defs/PartySummary" },
      "description": "Partes conforme constarem na petição."
    },

    "representations": {
      "type": "array",
      "items": { "$ref": "#/$defs/Representation" },
      "description": "Advogados/representantes conforme constarem na petição."
    },

    "peticao_identification": {
      "$ref": "#/$defs/PeticaoIdentification",
      "description": "Identificação textual da peça (ex.: 'PETIÇÃO INICIAL', 'EMENDA', 'MANIFESTAÇÃO')."
    },

    "valor_da_causa": {
      "$ref": "#/$defs/AnchoredString",
      "description": "Valor da causa como texto literal (quando constar)."
    },

    "fatos": {
      "type": "array",
      "items": { "$ref": "#/$defs/AnchoredTextItem" },
      "description": "Fatos narrados (itens literais, sem síntese criativa)."
    },

    "fundamentos": {
      "type": "array",
      "items": { "$ref": "#/$defs/AnchoredTextItem" },
      "description": "Fundamentos (jurídicos e/ou fáticos) conforme constarem."
    },

    "provas_e_requerimentos": {
      "type": "array",
      "items": { "$ref": "#/$defs/AnchoredTextItem" },
      "description": "Pedidos de prova, requerimentos e demais pleitos acessórios."
    },

    "pedidos": {
      "type": "array",
      "items": { "$ref": "#/$defs/Pedido" },
      "description": "Pedidos principais/expressos (cada item deve ter âncoras)."
    },

    "anchors": {
      "type": "array",
      "items": { "$ref": "#/$defs/Anchor" },
      "description": "Âncoras gerais (opcional). Preferir âncoras por campo/itens."
    }
  },

  "anyOf": [
    { "required": ["pedidos"] },
    { "required": ["fatos"] },
    { "required": ["fundamentos"] },
    { "required": ["valor_da_causa"] },
    { "required": ["parties"] }
  ],

  "unevaluatedProperties": false,

  "$defs": {
    "Anchor": {
      "$ref": "defs/common.schema.json#/$defs/Anchor"
    },

    "AnchoredString": {
      "type": "object",
      "required": ["value", "anchors"],
      "properties": {
        "value": { "$ref": "defs/common.schema.json#/$defs/NonEmptyString" },
        "anchors": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Anchor" }
        }
      },
      "unevaluatedProperties": false
    },

    "AnchoredTextItem": {
      "type": "object",
      "required": ["text", "anchors"],
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "maxLength": 6000,
          "description": "Trecho literal relevante do documento (não resumir; pode ser um parágrafo curto)."
        },
        "label": {
          "$ref": "defs/common.schema.json#/$defs/NonEmptyString",
          "description": "Rótulo curto opcional, se houver (ex.: 'Dos Fatos', 'Do Direito', 'Provas')."
        },
        "anchors": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Anchor" }
        }
      },
      "unevaluatedProperties": false
    },

    "PartySummary": {
      "type": "object",
      "required": ["name", "role", "anchors"],
      "properties": {
        "name": { "$ref": "defs/common.schema.json#/$defs/NonEmptyString" },
        "role": { "$ref": "defs/common.schema.json#/$defs/PartyRole" },
        "role_raw": {
          "$ref": "defs/common.schema.json#/$defs/NonEmptyString",
          "description": "Texto literal do papel, quando necessário."
        },
        "qualification": {
          "type": "string",
          "maxLength": 4000,
          "description": "Qualificação literal se constar."
        },
        "document_ids": {
          "type": "array",
          "items": { "$ref": "defs/common.schema.json#/$defs/NonEmptyString" },
          "description": "IDs explícitos (CPF/CNPJ/RG etc.) se constarem."
        },
        "anchors": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Anchor" }
        }
      },
      "unevaluatedProperties": false
    },

    "Lawyer": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": { "$ref": "defs/common.schema.json#/$defs/NonEmptyString" },
        "oab": { "$ref": "defs/common.schema.json#/$defs/NonEmptyString" }
      },
      "unevaluatedProperties": false
    },

    "Representation": {
      "type": "object",
      "required": ["represented_party_name", "lawyers", "anchors"],
      "properties": {
        "represented_party_name": {
          "$ref": "defs/common.schema.json#/$defs/NonEmptyString"
        },
        "lawyers": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Lawyer" }
        },
        "anchors": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Anchor" }
        }
      },
      "unevaluatedProperties": false
    },

    "PeticaoIdentification": {
      "type": "object",
      "required": ["value", "anchors"],
      "properties": {
        "value": {
          "$ref": "defs/common.schema.json#/$defs/NonEmptyString",
          "description": "Texto literal de identificação (ex.: 'PETIÇÃO INICIAL', 'EMENDA À INICIAL', 'MANIFESTAÇÃO')."
        },
        "anchors": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Anchor" }
        }
      },
      "unevaluatedProperties": false
    },

    "Pedido": {
      "type": "object",
      "required": ["text", "anchors"],
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "maxLength": 4000,
          "description": "Texto literal do pedido."
        },
        "label": {
          "$ref": "defs/common.schema.json#/$defs/NonEmptyString",
          "description": "Rótulo curto opcional (ex.: 'Pedido 1', 'a)', 'Tutela de urgência')."
        },
        "pedido_key": {
          "$ref": "defs/common.schema.json#/$defs/NonEmptyString",
          "description": "Chave opcional para deduplicação/merge (gerada somente se explícita/estável; não inferir)."
        },
        "anchors": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Anchor" }
        }
      },
      "unevaluatedProperties": false
    }
  }
}
